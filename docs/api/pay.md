# 支付服务商

> 可以用萝卜进行交易的机构 常见于 银行、游戏等

## 使用须知

- 申请时萝卜必须达到 `5k`
- 功能不建议与现有的相同
- 用户提现时手续费不得高于 `10‰`
- 建议接入 `web` 回传通知 只靠机器人回传可能会丢单

## 申请

调用 `申请成为服务商` 接口填写相关信息申请后请联系 `@emospg` 进行审核

## 使用

系统的订单号格式为 `40字符内` 的 `字符串`

其他参数格式建议为 `40字符内` 的 `数字字母组合`

支付方式分为两种 `web 网页版程序` 和 `telegram bot` 支付

调用 `创建订单` 接口创建订单后跳转到响应的 `pay_url`字段由用户进行操作

## 回传

鉴权 可以用 `param` 参数判断

更保险可以在收到回调后调用 `查询订单` 接口根据 `订单状态` 进行判断

### web

用户支付成功后 将会向 `回调地址` 发送 `post` 请求 `body` 如下

响应非 `200` 状态码时系统将在 `1分钟` `2分钟` `3分钟` `4分钟` `5分钟` 时进行重试

```json
{
    // 订单号
    "no": "20260209112233payEMOS",
    // 支付时间
    "time_payed": "2026-02-09 12:22:33",
    // 结算金额
    "price_settle": 2,
    // 其他参数
    "param": null,
    // 重试次数
    "notify_number": 1
}
```

### telegram bot

在创建订单时如果传入了 `callback_telegram_bot_name` 字段

将在用户手动点击了按钮后以 `DeepLink` 模式跳转到对应机器人

`https://t.me/[机器人的name]?start=[支付状态]-[订单号]-[其他参数]-[TgId]`

可根据支付状态 `emosPayAgree` 支付成功、`emosPayRefuse` 支付失败进行判断

示例地址

```text
支付成功无其他参数
https://t.me/emospg_bot?start=emosPayAgree-20260209112233payEMOS--8129903593

支付成功有其他参数
https://t.me/emospg_bot?start=emosPayAgree-20260209112233payEMOS-AABB-8129903593

支付失败时不管是否有其他参数都将为空
https://t.me/emospg_bot?start=emosPayRefuse-20260209112233payEMOS--8129903593
```

## 场景示例

### 存款

用户输入需要存款的金额

服务商调用 `创建订单` 接口并跳转到支付地址

用户支付后服务商收到系统的回传

存款成功

### 取款

用户输入需要取款的金额

服务商调用 `转账给用户` 接口进行转账

取款完成
